{{ define "main" }}
<article class="article-page">
  <header class="article-header">
    <div class="container">
      <p class="hero-eyebrow">Deal Spotlight</p>
      <h1>{{ .Title }}</h1>
      <div class="article-meta">
        {{ if .Params.store }}
        <span>{{ .Params.store }}</span>
        <span class="meta-separator">•</span>
        {{ end }}
        <time datetime="{{ .PublishDate.Format "2006-01-02" }}">{{ .PublishDate.Format "January 2, 2006" }}</time>
        {{ if .Params.discount }}
        <span class="meta-separator">•</span>
        <span>{{ .Params.discount }}% off</span>
        {{ end }}
      </div>
    </div>
  </header>

  {{ if .Params.image }}
  <div class="container">
    <figure class="article-cover">
      <img src="{{ .Params.image }}" alt="{{ .Title }}" width="1200" height="630" loading="lazy" />
    </figure>
  </div>
  {{ end }}

  <div class="container article-layout">
    <div class="article-content">
      {{ .Content }}

      {{ if .Params.features }}
      <h2>Key Features</h2>
      <ul>
        {{ range .Params.features }}
        <li>{{ . }}</li>
        {{ end }}
      </ul>
      {{ end }}

      {{ if .Params.pros }}
      <h2>Pros</h2>
      <ul>
        {{ range .Params.pros }}
        <li>{{ . }}</li>
        {{ end }}
      </ul>
      {{ end }}

      {{ if .Params.cons }}
      <h2>Cons</h2>
      <ul>
        {{ range .Params.cons }}
        <li>{{ . }}</li>
        {{ end }}
      </ul>
      {{ end }}
    </div>

    <aside class="article-sidebar">
      <div class="sidebar-card">
        <h2>Deal Snapshot</h2>
        <ul>
          {{ if .Params.originalPrice }}
          <li><strong>Was:</strong> ${{ .Params.originalPrice }}</li>
          {{ end }}
          {{ if .Params.price }}
          <li><strong>Now:</strong> ${{ .Params.price }}</li>
          {{ end }}
          {{ if .Params.discount }}
          <li><strong>Savings:</strong> {{ .Params.discount }}%</li>
          {{ end }}
          {{ if .Params.expiresAt }}
          <li><strong>Expires:</strong> {{ .Params.expiresAt }}</li>
          {{ end }}
        </ul>

        {{ if .Params.affiliateUrl }}
        <a
          href="{{ .Params.affiliateUrl }}"
          target="_blank"
          rel="noopener nofollow sponsored"
          class="affiliate-button"
          data-exchange="{{ if .Params.exchanges }}{{ index .Params.exchanges 0 }}{{ else }}deal{{ end }}"
          data-campaign="deal_sidebar"
          >Open Deal ↗</a>
        {{ else if .Params.amazonAsin }}
        <a
          href="https://www.amazon.com/dp/{{ .Params.amazonAsin }}?tag={{ .Site.Params.amazonTag }}"
          target="_blank"
          rel="noopener nofollow sponsored"
          class="affiliate-button"
          data-exchange="amazon"
          data-campaign="deal_sidebar"
          >Open Deal ↗</a>
        {{ end }}
      </div>

      {{ if .Params.stores }}
      <div class="sidebar-card">
        <h2>Compare Stores</h2>
        <ul>
          {{ range .Params.stores }}
          <li>
            <strong>{{ .name }}</strong> - ${{ .price }}
          </li>
          {{ end }}
        </ul>
      </div>
      {{ end }}

      <div class="sidebar-card affiliate-notice">
        <p><strong>Disclosure:</strong> {{ .Site.Params.affiliateDisclosure }}</p>
      </div>
    </aside>
  </div>

  <div class="container">
    {{ if .Params.tags }}
    <div class="post-tags">
      <strong>Tags:</strong>
      {{ range .Params.tags }}
      <a href="/tags/{{ . | urlize }}/" class="tag">#{{ . }}</a>
      {{ end }}
    </div>
    {{ end }}
  </div>
</article>
{{ end }}
