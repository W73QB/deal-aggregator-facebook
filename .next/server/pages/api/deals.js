"use strict";(()=>{var a={};a.id=516,a.ids=[516],a.modules={140:a=>{a.exports=[{id:1,title:"iPhone 14 Pro - Refurbished",image:"https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=400&h=400&fit=crop",originalPrice:999,salePrice:749,discount:25,rating:4.8,category:"smartphones",badge:"Featured",seller:"Apple Certified"},{id:2,title:"MacBook Air M2 - Open Box",image:"https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=400&h=400&fit=crop",originalPrice:1299,salePrice:999,discount:23,rating:4.9,category:"laptops",badge:"Hot Deal",seller:"Best Buy"},{id:3,title:"Samsung Galaxy S23",image:"https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=400&h=400&fit=crop",originalPrice:799,salePrice:599,discount:25,rating:4.6,category:"smartphones",badge:"Best Value",seller:"Samsung Direct"},{id:4,title:"Nintendo Switch OLED - Like New",image:"https://images.unsplash.com/photo-1606144042614-b2417e99c4e3?w=400&h=400&fit=crop",originalPrice:349,salePrice:279,discount:20,rating:4.7,category:"gaming",badge:"Popular",seller:"GameStop"},{id:5,title:"AirPods Pro 2nd Gen - Refurbished",image:"https://images.unsplash.com/photo-1588423771073-b8903fbb85b5?w=400&h=400&fit=crop",originalPrice:249,salePrice:179,discount:28,rating:4.8,category:"audio",badge:"Limited Time",seller:"Apple Certified"},{id:6,title:"Sony WH-1000XM5 - Open Box",image:"https://www.sony.com/image/5d02da5df55283e84e344c8952469462?fmt=pjpeg&wid=1440&hei=1440&bgcolor=F1F5F9",originalPrice:399,salePrice:299,discount:25,rating:4.9,category:"audio",badge:"Editor's Choice",seller:"Sony Direct"},{id:7,title:"Google Pixel 7 - Open Box",image:"https://storage.googleapis.com/gweb-uniblog-publish-prod/images/Google_Pixel_7_Pro_and_Pixel_7.width-1000.format-webp.webp",originalPrice:599,salePrice:449,discount:25,rating:4.7,category:"smartphones",badge:"Great Value",seller:"Google Store"},{id:8,title:"Dell XPS 15 Laptop",image:"https://i.dell.com/is/image/DellContent/content/dam/ss2/product-images/dell-client-products/notebooks/xps-notebooks/xps-15-9530/media-gallery/touch-platinum-silver/notebook-xps-15-9530-t-platinum-silver-gallery-1.psd?fmt=pjpg&pscan=auto&scl=1&wid=3782&hei=2988&qlt=100,0&resMode=sharp2&size=3782,2988",originalPrice:1899,salePrice:1399,discount:26,rating:4.6,category:"laptops",badge:"Powerhouse",seller:"Dell Outlet"},{id:9,title:"Amazon Echo Show 8",image:"https://m.media-amazon.com/images/I/61yZ38kP9KL._AC_SL1000_.jpg",originalPrice:129,salePrice:89,discount:31,rating:4.7,category:"smart-home",badge:"Smart Display",seller:"Amazon"}]},818:a=>{a.exports=require("dotenv")},2449:a=>{a.exports=require("pg")},5600:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6472:a=>{a.exports=require("@opentelemetry/api")},9975:(a,b,c)=>{c.r(b),c.d(b,{config:()=>t,default:()=>s,handler:()=>v});var d={};c.r(d),c.d(d,{default:()=>p});var e=c(9046),f=c(8667),g=c(3480),h=c(6435),i=c(140);let j=null,k=null;async function l(){if(!j)try{j=await c.e(868).then(c.t.bind(c,8868,19))}catch(a){return null}return j}async function m(){if(k)return k;let a=await l();if(!a)return{useFallback:!0};try{if("function"==typeof a.getInstance&&(k=a.getInstance()),!k){let b=a.default;b?.query&&(k=b),k||"function"!=typeof b||(global._dealAggregatorDbInstance||(global._dealAggregatorDbInstance=new b),k=global._dealAggregatorDbInstance)}if(k||"function"!=typeof a.DatabaseConnection||(global._dealAggregatorDbInstance||(global._dealAggregatorDbInstance=new a.DatabaseConnection),k=global._dealAggregatorDbInstance),k?.initialize&&!k.__initialized&&(await k.initialize(),k.__initialized=!0),k?.query)return k}catch(a){}return{useFallback:!0}}async function n(a={}){try{let b=await m();if(b.useFallback)return o(i,a);let c=`
      SELECT
        id, title, description, image, original_price, sale_price,
        discount, rating, category, featured, store, affiliate_url,
        created_at, updated_at
      FROM deals
      WHERE active = true
    `,d=[],e=1;return a.category&&(c+=` AND LOWER(category) = $${e}`,d.push(a.category.toLowerCase()),e++),"true"===a.featured&&(c+=" AND featured = true"),c+=" ORDER BY created_at DESC",a.limit&&!isNaN(parseInt(a.limit))&&(c+=` LIMIT $${e}`,d.push(parseInt(a.limit))),(await b.query(c,d)).rows.map(a=>({id:a.id,title:a.title,description:a.description,image:a.image,originalPrice:a.original_price,salePrice:a.sale_price,discount:a.discount,rating:a.rating,category:a.category,featured:a.featured,store:a.store,affiliateUrl:a.affiliate_url,createdAt:a.created_at,updatedAt:a.updated_at}))}catch(b){return o(i,a)}}function o(a,b){let c=[...a];if(b.category&&(c=c.filter(a=>a.category?.toLowerCase()===b.category.toLowerCase())),"true"===b.featured&&(c=c.filter(a=>!0===a.featured)),b.limit){let a=parseInt(b.limit);!isNaN(a)&&a>0&&(c=c.slice(0,a))}return c}async function p(a,b){if("GET"===a.method){b.setHeader("Cache-Control","public, s-maxage=1800, stale-while-revalidate=3600"),b.setHeader("Content-Type","application/json");try{let{category:c,featured:d,limit:e}=a.query,f={category:c,featured:d,limit:e},g=await n(f),h=g.reduce((a,b)=>{let c=(b.originalPrice||b.original_price||0)-(b.salePrice||b.sale_price||0);return a+Math.max(0,c)},0),i=g.length>0?(g.reduce((a,b)=>a+(b.rating||0),0)/g.length).toFixed(1):0;b.status(200).json({success:!0,data:g,meta:{total:g.length,totalSavings:h,averageRating:parseFloat(i),filters:f,timestamp:new Date().toISOString(),source:dbInstance?.useFallback?"static":"database"}})}catch(a){b.status(500).json({success:!1,error:"Internal server error",message:"Failed to fetch deals",timestamp:new Date().toISOString()})}}else b.setHeader("Allow",["GET"]),b.status(405).json({success:!1,error:"Method not allowed",message:`Method ${a.method} not allowed on /api/deals`,allowedMethods:["GET"]})}var q=c(8112),r=c(6385);let s=(0,h.M)(d,"default"),t=(0,h.M)(d,"config"),u=new g.PagesAPIRouteModule({definition:{kind:f.A.PAGES_API,page:"/api/deals",pathname:"/api/deals",bundlePath:"",filename:""},userland:d,distDir:".next",relativeProjectDir:""});async function v(a,b,c){let d=await u.prepare(a,b,{srcPage:"/api/deals"});if(!d){b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve());return}let{query:f,params:g,prerenderManifest:h,routerServerContext:i}=d;try{let c=a.method||"GET",d=(0,q.getTracer)(),e=d.getActiveScopeSpan(),j=u.instrumentationOnRequestError.bind(u),k=async e=>u.render(a,b,{query:{...f,...g},params:g,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:h.preview,propagateError:!1,dev:u.isDev,page:"/api/deals",internalRevalidate:null==i?void 0:i.revalidate,onError:(...b)=>j(a,...b)}).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let f=d.getRootSpanAttributes();if(!f)return;if(f.get("next.span_type")!==r.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${f.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let g=f.get("next.route");if(g){let a=`${c} ${g}`;e.setAttributes({"next.route":g,"http.route":g,"next.span_name":a}),e.updateName(a)}else e.updateName(`${c} ${a.url}`)});e?await k(e):await d.withPropagatedContext(a.headers,()=>d.trace(r.BaseServerSpan.handleRequest,{spanName:`${c} ${a.url}`,kind:q.SpanKind.SERVER,attributes:{"http.method":c,"http.target":a.url}},k))}catch(a){if(u.isDev)throw a;(0,e.sendError)(b,500,"Internal Server Error")}finally{null==c.waitUntil||c.waitUntil.call(c,Promise.resolve())}}}};var b=require("../../webpack-api-runtime.js");b.C(a);var c=b.X(0,[544,30,392,125,465,173,76],()=>b(b.s=9975));module.exports=c})();