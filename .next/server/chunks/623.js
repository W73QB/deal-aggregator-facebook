"use strict";exports.id=623,exports.ids=[623],exports.modules={5623:(a,b,c)=>{function d(a){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function e(){e=function(){return b};var a,b={},c=Object.prototype,f=c.hasOwnProperty,g=Object.defineProperty||function(a,b,c){a[b]=c.value},h="function"==typeof Symbol?Symbol:{},i=h.iterator||"@@iterator",j=h.asyncIterator||"@@asyncIterator",k=h.toStringTag||"@@toStringTag";function l(a,b,c){return Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}),a[b]}try{l({},"")}catch(a){l=function(a,b,c){return a[b]=c}}function m(b,c,d,e){var f,h,i,j,k=Object.create((c&&c.prototype instanceof s?c:s).prototype);return g(k,"_invoke",{value:(f=b,h=d,i=new D(e||[]),j=o,function(b,c){if(j===p)throw Error("Generator is already running");if(j===q){if("throw"===b)throw c;return{value:a,done:!0}}for(i.method=b,i.arg=c;;){var d=i.delegate;if(d){var e=function b(c,d){var e=d.method,f=c.iterator[e];if(f===a)return d.delegate=null,"throw"===e&&c.iterator.return&&(d.method="return",d.arg=a,b(c,d),"throw"===d.method)||"return"!==e&&(d.method="throw",d.arg=TypeError("The iterator does not provide a '"+e+"' method")),r;var g=n(f,c.iterator,d.arg);if("throw"===g.type)return d.method="throw",d.arg=g.arg,d.delegate=null,r;var h=g.arg;return h?h.done?(d[c.resultName]=h.value,d.next=c.nextLoc,"return"!==d.method&&(d.method="next",d.arg=a),d.delegate=null,r):h:(d.method="throw",d.arg=TypeError("iterator result is not an object"),d.delegate=null,r)}(d,i);if(e){if(e===r)continue;return e}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(j===o)throw j=q,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);j=p;var g=n(f,h,i);if("normal"===g.type){if(j=i.done?q:"suspendedYield",g.arg===r)continue;return{value:g.arg,done:i.done}}"throw"===g.type&&(j=q,i.method="throw",i.arg=g.arg)}})}),k}function n(a,b,c){try{return{type:"normal",arg:a.call(b,c)}}catch(a){return{type:"throw",arg:a}}}b.wrap=m;var o="suspendedStart",p="executing",q="completed",r={};function s(){}function t(){}function u(){}var v={};l(v,i,function(){return this});var w=Object.getPrototypeOf,x=w&&w(w(E([])));x&&x!==c&&f.call(x,i)&&(v=x);var y=u.prototype=s.prototype=Object.create(v);function z(a){["next","throw","return"].forEach(function(b){l(a,b,function(a){return this._invoke(b,a)})})}function A(a,b){var c;g(this,"_invoke",{value:function(e,g){function h(){return new b(function(c,h){!function c(e,g,h,i){var j=n(a[e],a,g);if("throw"!==j.type){var k=j.arg,l=k.value;return l&&"object"==d(l)&&f.call(l,"__await")?b.resolve(l.__await).then(function(a){c("next",a,h,i)},function(a){c("throw",a,h,i)}):b.resolve(l).then(function(a){k.value=a,h(k)},function(a){return c("throw",a,h,i)})}i(j.arg)}(e,g,c,h)})}return c=c?c.then(h,h):h()}})}function B(a){var b={tryLoc:a[0]};1 in a&&(b.catchLoc=a[1]),2 in a&&(b.finallyLoc=a[2],b.afterLoc=a[3]),this.tryEntries.push(b)}function C(a){var b=a.completion||{};b.type="normal",delete b.arg,a.completion=b}function D(a){this.tryEntries=[{tryLoc:"root"}],a.forEach(B,this),this.reset(!0)}function E(b){if(b||""===b){var c=b[i];if(c)return c.call(b);if("function"==typeof b.next)return b;if(!isNaN(b.length)){var e=-1,g=function c(){for(;++e<b.length;)if(f.call(b,e))return c.value=b[e],c.done=!1,c;return c.value=a,c.done=!0,c};return g.next=g}}throw TypeError(d(b)+" is not iterable")}return t.prototype=u,g(y,"constructor",{value:u,configurable:!0}),g(u,"constructor",{value:t,configurable:!0}),t.displayName=l(u,k,"GeneratorFunction"),b.isGeneratorFunction=function(a){var b="function"==typeof a&&a.constructor;return!!b&&(b===t||"GeneratorFunction"===(b.displayName||b.name))},b.mark=function(a){return Object.setPrototypeOf?Object.setPrototypeOf(a,u):(a.__proto__=u,l(a,k,"GeneratorFunction")),a.prototype=Object.create(y),a},b.awrap=function(a){return{__await:a}},z(A.prototype),l(A.prototype,j,function(){return this}),b.AsyncIterator=A,b.async=function(a,c,d,e,f){void 0===f&&(f=Promise);var g=new A(m(a,c,d,e),f);return b.isGeneratorFunction(c)?g:g.next().then(function(a){return a.done?a.value:g.next()})},z(y),l(y,k,"Generator"),l(y,i,function(){return this}),l(y,"toString",function(){return"[object Generator]"}),b.keys=function(a){var b=Object(a),c=[];for(var d in b)c.push(d);return c.reverse(),function a(){for(;c.length;){var d=c.pop();if(d in b)return a.value=d,a.done=!1,a}return a.done=!0,a}},b.values=E,D.prototype={constructor:D,reset:function(b){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(C),!b)for(var c in this)"t"===c.charAt(0)&&f.call(this,c)&&!isNaN(+c.slice(1))&&(this[c]=a)},stop:function(){this.done=!0;var a=this.tryEntries[0].completion;if("throw"===a.type)throw a.arg;return this.rval},dispatchException:function(b){if(this.done)throw b;var c=this;function d(d,e){return h.type="throw",h.arg=b,c.next=d,e&&(c.method="next",c.arg=a),!!e}for(var e=this.tryEntries.length-1;e>=0;--e){var g=this.tryEntries[e],h=g.completion;if("root"===g.tryLoc)return d("end");if(g.tryLoc<=this.prev){var i=f.call(g,"catchLoc"),j=f.call(g,"finallyLoc");if(i&&j){if(this.prev<g.catchLoc)return d(g.catchLoc,!0);if(this.prev<g.finallyLoc)return d(g.finallyLoc)}else if(i){if(this.prev<g.catchLoc)return d(g.catchLoc,!0)}else{if(!j)throw Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return d(g.finallyLoc)}}}},abrupt:function(a,b){for(var c=this.tryEntries.length-1;c>=0;--c){var d=this.tryEntries[c];if(d.tryLoc<=this.prev&&f.call(d,"finallyLoc")&&this.prev<d.finallyLoc){var e=d;break}}e&&("break"===a||"continue"===a)&&e.tryLoc<=b&&b<=e.finallyLoc&&(e=null);var g=e?e.completion:{};return g.type=a,g.arg=b,e?(this.method="next",this.next=e.finallyLoc,r):this.complete(g)},complete:function(a,b){if("throw"===a.type)throw a.arg;return"break"===a.type||"continue"===a.type?this.next=a.arg:"return"===a.type?(this.rval=this.arg=a.arg,this.method="return",this.next="end"):"normal"===a.type&&b&&(this.next=b),r},finish:function(a){for(var b=this.tryEntries.length-1;b>=0;--b){var c=this.tryEntries[b];if(c.finallyLoc===a)return this.complete(c.completion,c.afterLoc),C(c),r}},catch:function(a){for(var b=this.tryEntries.length-1;b>=0;--b){var c=this.tryEntries[b];if(c.tryLoc===a){var d=c.completion;if("throw"===d.type){var e=d.arg;C(c)}return e}}throw Error("illegal catch attempt")},delegateYield:function(b,c,d){return this.delegate={iterator:E(b),resultName:c,nextLoc:d},"next"===this.method&&(this.arg=a),r}},b}function f(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function g(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var g=a.apply(b,c);function h(a){f(g,d,e,h,i,"next",a)}function i(a){f(g,d,e,h,i,"throw",a)}h(void 0)})}}c.r(b);var h=require("pg").Pool,i=require("./database-fallback");require("dotenv").config({path:".env.dealradarus.local"});var j=null,k=function(){var a,b,c,f,j,k,l;return k=function a(){var b=this;if(!(this instanceof a))throw TypeError("Cannot call a class as a function");if(this.useFallback=!1,this.connectionString=process.env.DATABASE_URL_POOLER||process.env.DATABASE_URL,!this.connectionString){console.log("⚠️  No DATABASE_URL found, using fallback mode"),this.useFallback=!0;return}this.pool=new h({connectionString:this.connectionString,ssl:!0,max:5,idleTimeoutMillis:6e4,connectionTimeoutMillis:1e4,keepAlive:!0,keepAliveInitialDelayMillis:1e4}),this.testConnection().catch(function(){console.log("⚠️  Database connection failed, switching to fallback mode"),b.useFallback=!0})},l=[{key:"getClient",value:(a=g(e().mark(function a(){return e().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!this.useFallback){a.next=2;break}return a.next=1,i.getClient();case 1:case 3:return a.abrupt("return",a.sent);case 2:return a.next=3,this.pool.connect();case 4:case"end":return a.stop()}},a,this)})),function(){return a.apply(this,arguments)})},{key:"query",value:(b=g(e().mark(function a(b,c){var d;return e().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!this.useFallback){a.next=2;break}return a.next=1,i.query(b,c);case 1:case 5:return a.abrupt("return",a.sent);case 2:return a.prev=2,a.next=3,this.pool.query(b,c);case 3:return d=a.sent,a.abrupt("return",d);case 4:return a.prev=4,console.error("Database query error, switching to fallback:",a.catch(2).message),this.useFallback=!0,a.next=5,i.query(b,c);case 6:case"end":return a.stop()}},a,this,[[2,4]])})),function(a,c){return b.apply(this,arguments)})},{key:"testConnection",value:(c=g(e().mark(function a(){var b;return e().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!this.useFallback){a.next=2;break}return a.next=1,i.testConnection();case 1:case 5:return a.abrupt("return",a.sent);case 2:return a.prev=2,a.next=3,this.pool.query("SELECT NOW()");case 3:return b=a.sent,a.abrupt("return",b);case 4:return a.prev=4,console.error("Database connection test failed:",a.catch(2).message),this.useFallback=!0,a.next=5,i.testConnection();case 6:case"end":return a.stop()}},a,this,[[2,4]])})),function(){return c.apply(this,arguments)})},{key:"close",value:(f=g(e().mark(function a(){return e().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!this.useFallback){a.next=2;break}return a.next=1,i.close();case 1:return a.abrupt("return",a.sent);case 2:return a.next=3,this.pool.end();case 3:case"end":return a.stop()}},a,this)})),function(){return f.apply(this,arguments)})},{key:"transaction",value:(j=g(e().mark(function a(b){var c,d,f;return e().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=1,this.getClient();case 1:return c=a.sent,a.prev=2,a.next=3,c.query("BEGIN");case 3:return a.next=4,b(c);case 4:return d=a.sent,a.next=5,c.query("COMMIT");case 5:return a.abrupt("return",d);case 6:return a.prev=6,f=a.catch(2),a.next=7,c.query("ROLLBACK");case 7:throw f;case 8:return a.prev=8,a.next=9,c.end();case 9:return a.finish(8);case 10:case"end":return a.stop()}},a,this,[[2,6,8,10]])})),function(a){return j.apply(this,arguments)})}],function(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(a,function(a){var b=function(a,b){if("object"!=d(a)||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var e=c.call(a,b||"default");if("object"!=d(e))return e;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}(a,"string");return"symbol"==d(b)?b:b+""}(e.key),e)}}(k.prototype,l),Object.defineProperty(k,"prototype",{writable:!1}),k}();j||(j=new k),module.exports=j}};